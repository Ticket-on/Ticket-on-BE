<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>결제 성공</title>
</head>
<body>
<h1>✅ 결제가 완료되었습니다!</h1>
<p id="status">결제 승인 처리 중...</p>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const paymentKey = urlParams.get('paymentKey');
    const orderId = urlParams.get('orderId'); // = ticketId
    const amount = urlParams.get('amount');
    const memberId = urlParams.get('memberId');

    const ticketId = Number(orderId);

    fetch('http://localhost:8080/v1/payments/confirm', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            memberId: Number(memberId),
            paymentKey: paymentKey,
            ticketId: orderId, // ✅ orderId = ticketId
            amount: Number(amount)
        })
    })
        .then(res => {
            if (!res.ok) throw new Error('결제 승인 실패');
            return res.json();
        })
        .then(data => {
            document.getElementById('status').innerText = '🎉 결제 승인 완료!';
        })
        .catch(err => {
            document.getElementById('status').innerText = '❌ 오류: ' + err.message;
        });
</script>
</body>
</html>
